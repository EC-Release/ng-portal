<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#375EAB">

  <title>wzapi - The Go Programming Language</title>

<link type="text/css" rel="stylesheet" href="lib/godoc/style.css">


<script>window.initFuncs = [];</script>

<script src="lib/godoc/jquery.js" defer></script>



<script>var goVersion = "go1.12.17";</script>
<script src="lib/godoc/godocs.js" defer></script>
</head>
<body>

<div id='lowframe' style="position: fixed; bottom: 0; left: 0; height: 0; width: 100%; border-top: thin solid grey; background-color: white; overflow: auto;">
...
</div><!-- #lowframe -->

<div id="topbar" class="wide"><div class="container">
<div class="top-heading" id="heading-wide"><a href="/">The Go Programming Language</a></div>
<div class="top-heading" id="heading-narrow"><a href="/">Go</a></div>
<a href="#" id="menu-button"><span id="menu-button-arrow">&#9661;</span></a>
<form method="GET" action="/search">
<div id="menu">
<a href="/doc/">Documents</a>
<a href="/pkg/">Packages</a>
<a href="/project/">The Project</a>
<a href="/help/">Help</a>

<a href="/blog/">Blog</a>


<span class="search-box"><input type="search" id="search" name="q" placeholder="Search" aria-label="Search" required><button type="submit"><span><!-- magnifying glass: --><svg width="24" height="24" viewBox="0 0 24 24"><title>submit search</title><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/><path d="M0 0h24v24H0z" fill="none"/></svg></span></button></span>
</div>
</form>

</div></div>



<div id="page" class="wide">
<div class="container">


  <h1>
    Package wzapi
    <span class="text-muted"></span>
  </h1>







<div id="nav"></div>


<!--
	Copyright 2009 The Go Authors. All rights reserved.
	Use of this source code is governed by a BSD-style
	license that can be found in the LICENSE file.
-->
<!--
	Note: Static (i.e., not template-generated) href and id
	attributes start with "pkg-" to make it impossible for
	them to conflict with generated attributes (some of which
	correspond to Go identifiers).
-->

	<script>
	document.ANALYSIS_DATA = null;
	document.CALLGRAPH = null;
	</script>

	
		
		<div id="short-nav">
			<dl>
			<dd><code>import "github.com/wzlib/wzapi"</code></dd>
			</dl>
			<dl>
			<dd><a href="#pkg-overview" class="overviewLink">Overview</a></dd>
			<dd><a href="#pkg-index" class="indexLink">Index</a></dd>
			
			
			</dl>
		</div>
		<!-- The package's Name is printed as title by the top-level template -->
		<div id="pkg-overview" class="toggleVisible">
			<div class="collapsed">
				<h2 class="toggleButton" title="Click to show Overview section">Overview ▹</h2>
			</div>
			<div class="expanded">
				<h2 class="toggleButton" title="Click to hide Overview section">Overview ▾</h2>
				
				
			</div>
		</div>

		<div id="pkg-index" class="toggleVisible">
		<div class="collapsed">
			<h2 class="toggleButton" title="Click to show Index section">Index ▹</h2>
		</div>
		<div class="expanded">
			<h2 class="toggleButton" title="Click to hide Index section">Index ▾</h2>

		<!-- Table of contents for API; must be named manual-nav to turn off auto nav. -->
			<div id="manual-nav">
			<dl>
			
				<dd><a href="#pkg-constants">Constants</a></dd>
			
			
			
				
				<dd><a href="#FetchOAuthTokenByCode">func FetchOAuthTokenByCode(cid, csc, authCode, redirectURL, authCodeURL string) &lt;-chan *model.Token</a></dd>
			
				
				<dd><a href="#FetchOIDCUserInfo">func FetchOIDCUserInfo(headers []string, _method, _tkn, userInfoURL string) &lt;-chan map[string]interface{}</a></dd>
			
				
				<dd><a href="#FetchOIDCUserInfoArr">func FetchOIDCUserInfoArr(headers []string, _method, _tkn, userInfoURL string) &lt;-chan []map[string]interface{}</a></dd>
			
			
				
				<dd><a href="#APIMode">type APIMode</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#NewAPIMode">func NewAPIMode(wagt AgentHTTPIntr, ac *util.ConfigSet) *APIMode</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.EnforceToken">func (a *APIMode) EnforceToken(_tk string) (*model.TokenStatus, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.FetchTokenByAuthCode">func (a *APIMode) FetchTokenByAuthCode(code, rurl string) (*model.Token, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.FetchUserDetailByUserId">func (a *APIMode) FetchUserDetailByUserId(uid string) (*model.UserDetail, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.GetOAuthToken">func (a *APIMode) GetOAuthToken() (tkn string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.GetUserDetail">func (a *APIMode) GetUserDetail(uid string) (*model.UserDetail, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.RedirectAuthForm">func (a *APIMode) RedirectAuthForm(w http.ResponseWriter, originURL string) error</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.Start">func (a *APIMode) Start(tls bool, _ap, app, sed, nod string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#APIMode.Stop">func (a *APIMode) Stop()</a></dd>
				
			
				
				<dd><a href="#AgentHTTPIntr">type AgentHTTPIntr</a></dd>
				
				
			
				
				<dd><a href="#OAuth2Mode">type OAuth2Mode</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#NewOAuth2Mode">func NewOAuth2Mode(oagt OAuth2ModeIntr, authgrp []interface{}, _rv string) *OAuth2Mode</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuth2Mode.EvalToken">func (o *OAuth2Mode) EvalToken(tk string) (cd *model.UserDetail, err error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuth2Mode.GetSubscriptionById">func (o *OAuth2Mode) GetSubscriptionById(sid string) (*OAuthSubscription, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuth2Mode.Start">func (o *OAuth2Mode) Start(_ap string, tls bool)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuth2Mode.Stop">func (o *OAuth2Mode) Stop()</a></dd>
				
			
				
				<dd><a href="#OAuth2ModeIntr">type OAuth2ModeIntr</a></dd>
				
				
			
				
				<dd><a href="#OAuth2Ops">type OAuth2Ops</a></dd>
				
				
			
				
				<dd><a href="#OAuthCertLocker">type OAuthCertLocker</a></dd>
				
				
			
				
				<dd><a href="#OAuthCodeLocker">type OAuthCodeLocker</a></dd>
				
				
			
				
				<dd><a href="#OAuthOIDCDetail">type OAuthOIDCDetail</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuthOIDCDetail.ConvertUserScopes">func (oa *OAuthOIDCDetail) ConvertUserScopes(oidcscp []string) []string</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuthOIDCDetail.FetchOIDCTokenByAuthCode">func (oa *OAuthOIDCDetail) FetchOIDCTokenByAuthCode(code, rurl string) (*model.Token, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuthOIDCDetail.FetchOIDCUserInfo">func (oa *OAuthOIDCDetail) FetchOIDCUserInfo(tkn string) (*model.UserDetail, error)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuthOIDCDetail.GetAllOIDCScopes">func (oa *OAuthOIDCDetail) GetAllOIDCScopes() (scp []string)</a></dd>
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuthOIDCDetail.SetOIDCUserDetail">func (oa *OAuthOIDCDetail) SetOIDCUserDetail(u map[string]interface{}) (ud *model.UserDetail)</a></dd>
				
			
				
				<dd><a href="#OAuthSubscription">type OAuthSubscription</a></dd>
				
				
					
					<dd>&nbsp; &nbsp; <a href="#OAuthSubscription.GetUserDetail">func (c *OAuthSubscription) GetUserDetail() (ud *model.UserDetail)</a></dd>
				
			
				
				<dd><a href="#ProfileLocker">type ProfileLocker</a></dd>
				
				
			
			
			</dl>
			</div><!-- #manual-nav -->

		

		
			<h3>Package files</h3>
			<p>
			<span style="font-size:90%">
			
				<a href="/src/github.com/wzlib/wzapi/apimode.go">apimode.go</a>
			
				<a href="/src/github.com/wzlib/wzapi/oa2mode.go">oa2mode.go</a>
			
				<a href="/src/github.com/wzlib/wzapi/wzapi.go">wzapi.go</a>
			
			</span>
			</p>
		
		</div><!-- .expanded -->
		</div><!-- #pkg-index -->

		

		
			<h2 id="pkg-constants">Constants</h2>
			
				
				<pre>const (
    <span id="HTML_APIMODE_DIR">HTML_APIMODE_DIR</span>    = &#34;webui-assets&#34;
    <span id="HTML_APIMODE_INDEX">HTML_APIMODE_INDEX</span>  = &#34;webui-assets/index.html&#34;
    <span id="HTML_APIMODE_LOGOUT">HTML_APIMODE_LOGOUT</span> = &#34;webui-assets/logout.html&#34;
)</pre>
			
				
				<pre>const (

    <span class="comment">// E.g. vendor: github</span>
    <span id="OAUTH_OIDC">OAUTH_OIDC</span>   = &#34;/oidc/&#34;
    <span id="OAUTH_ASSET">OAUTH_ASSET</span>  = &#34;/assets/&#34;
    <span id="OAUTH_USER">OAUTH_USER</span>   = &#34;/users/&#34;
    <span id="OAUTH_CLIENT">OAUTH_CLIENT</span> = &#34;/clients/&#34;

    <span id="HTML_OA2MODE_DIR">HTML_OA2MODE_DIR</span> = &#34;oa2-assets&#34;
    <span id="HTML_OA2MODE_IDX">HTML_OA2MODE_IDX</span> = &#34;login.html&#34;

    <span id="OAUTH_FIELD_OIDC_SCP_IDX">OAUTH_FIELD_OIDC_SCP_IDX</span> = &#34;scopeIndex&#34;
    <span id="OAUTH_FIELD_OIDC_USR_IDX">OAUTH_FIELD_OIDC_USR_IDX</span> = &#34;userIdField&#34;

    <span id="OAUTH_FIELD_OIDC_VENDOR">OAUTH_FIELD_OIDC_VENDOR</span> = &#34;vendor&#34;
)</pre>
			
		
		
		
			
			
			<h2 id="FetchOAuthTokenByCode">func <a href="/src/github.com/wzlib/wzapi/wzapi.go?s=4764:4865#L216">FetchOAuthTokenByCode</a>
				<a class="permalink" href="#FetchOAuthTokenByCode">&#xb6;</a>
				
				
			</h2>
			<pre>func FetchOAuthTokenByCode(cid, csc, authCode, redirectURL, authCodeURL <a href="/pkg/builtin/#string">string</a>) &lt;-chan *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#Token">Token</a></pre>
			<p>
FetchOAuthTokenByCode fetch a 3rd-party token by the authorization code
</p>

			
			

		
			
			
			<h2 id="FetchOIDCUserInfo">func <a href="/src/github.com/wzlib/wzapi/wzapi.go?s=2388:2494#L97">FetchOIDCUserInfo</a>
				<a class="permalink" href="#FetchOIDCUserInfo">&#xb6;</a>
				
				
			</h2>
			<pre>func FetchOIDCUserInfo(headers []<a href="/pkg/builtin/#string">string</a>, _method, _tkn, userInfoURL <a href="/pkg/builtin/#string">string</a>) &lt;-chan map[<a href="/pkg/builtin/#string">string</a>]interface{}</pre>
			<p>
FetchOIDCUserInfo fetch the 3rd-party oidc user information
</p>

			
			

		
			
			
			<h2 id="FetchOIDCUserInfoArr">func <a href="/src/github.com/wzlib/wzapi/wzapi.go?s=3824:3935#L168">FetchOIDCUserInfoArr</a>
				<a class="permalink" href="#FetchOIDCUserInfoArr">&#xb6;</a>
				
				
			</h2>
			<pre>func FetchOIDCUserInfoArr(headers []<a href="/pkg/builtin/#string">string</a>, _method, _tkn, userInfoURL <a href="/pkg/builtin/#string">string</a>) &lt;-chan []map[<a href="/pkg/builtin/#string">string</a>]interface{}</pre>
			<p>
FetchOIDCUserInfo fetch the 3rd-party oidc user information
</p>

			
			

		
		
			
			
			<h2 id="APIMode">type <a href="/src/github.com/wzlib/wzapi/apimode.go?s=687:1045#L35">APIMode</a>
				<a class="permalink" href="#APIMode">&#xb6;</a>
				
				
			</h2>
			
			<pre>type APIMode struct {
<span id="APIMode.Cert"></span>    Cert *<a href="/pkg/github.com/wzlib/wzutil/">util</a>.<a href="/pkg/github.com/wzlib/wzutil/#Cert">Cert</a>

<span id="APIMode.OAuth2URL"></span>    OAuth2URL     *<a href="/pkg/net/url/">url</a>.<a href="/pkg/net/url/#URL">URL</a>
<span id="APIMode.AgentHTTPIntr"></span>    AgentHTTPIntr <a href="#AgentHTTPIntr">AgentHTTPIntr</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewAPIMode">func <a href="/src/github.com/wzlib/wzapi/apimode.go?s=3251:3315#L90">NewAPIMode</a>
					<a class="permalink" href="#NewAPIMode">&#xb6;</a>
					
					
				</h3>
				<pre>func NewAPIMode(wagt <a href="#AgentHTTPIntr">AgentHTTPIntr</a>, ac *<a href="/pkg/github.com/wzlib/wzutil/">util</a>.<a href="/pkg/github.com/wzlib/wzutil/#ConfigSet">ConfigSet</a>) *<a href="#APIMode">APIMode</a></pre>
				<p>
create a new agent api mode instance. wagt refers to the callback interface. pt represents  api http port, where crt an preloaded cert instance.
start the agent api.
@wagt: API callback Interface
@_ap: port#
@_pb: publickey
@_ps: privatekey
@_oa: oauth instance
@_an: the api context path
@_tl: is TLS enable
func NewAPIMode(wagt AgentHTTPIntr, cred map[string]interface{}, _id, _oa, _rv string) *APIMode {
</p>

				
				
			

			
				
				<h3 id="APIMode.EnforceToken">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=15140:15209#L640">EnforceToken</a>
					<a class="permalink" href="#APIMode.EnforceToken">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) EnforceToken(_tk <a href="/pkg/builtin/#string">string</a>) (*<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#TokenStatus">TokenStatus</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				
				
				
				
			
				
				<h3 id="APIMode.FetchTokenByAuthCode">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=13286:13363#L563">FetchTokenByAuthCode</a>
					<a class="permalink" href="#APIMode.FetchTokenByAuthCode">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) FetchTokenByAuthCode(code, rurl <a href="/pkg/builtin/#string">string</a>) (*<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#Token">Token</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				
				
				
				
			
				
				<h3 id="APIMode.FetchUserDetailByUserId">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=14084:14163#L589">FetchUserDetailByUserId</a>
					<a class="permalink" href="#APIMode.FetchUserDetailByUserId">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) FetchUserDetailByUserId(uid <a href="/pkg/builtin/#string">string</a>) (*<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				<p>
FetchUserDetailByUserId gives detail of the user id @@uid. In OIDC validation, the user id (@@uid) maps to an OIDC identifier which specified in the config settings
The function will first check the user detail in the cache and decide whether invoke a user http call
</p>

				
				
				
			
				
				<h3 id="APIMode.GetOAuthToken">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=4492:4537#L155">GetOAuthToken</a>
					<a class="permalink" href="#APIMode.GetOAuthToken">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) GetOAuthToken() (tkn <a href="/pkg/builtin/#string">string</a>)</pre>
				<p>
GetOAuthToken return a valid token for authorisation purpose
</p>

				
				
				
			
				
				<h3 id="APIMode.GetUserDetail">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=14534:14603#L612">GetUserDetail</a>
					<a class="permalink" href="#APIMode.GetUserDetail">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) GetUserDetail(uid <a href="/pkg/builtin/#string">string</a>) (*<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				<p>
GetUserDetail will directly invoke the users detail endpoint from the oauth2 instance
</p>

				
				
				
			
				
				<h3 id="APIMode.RedirectAuthForm">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=12155:12236#L524">RedirectAuthForm</a>
					<a class="permalink" href="#APIMode.RedirectAuthForm">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) RedirectAuthForm(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, originURL <a href="/pkg/builtin/#string">string</a>) <a href="/pkg/builtin/#error">error</a></pre>
				
				
				
				
			
				
				<h3 id="APIMode.Start">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=5057:5117#L178">Start</a>
					<a class="permalink" href="#APIMode.Start">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) Start(tls <a href="/pkg/builtin/#bool">bool</a>, _ap, app, sed, nod <a href="/pkg/builtin/#string">string</a>)</pre>
				<p>
Starting Agent in API mode.
AgentHTTPIntr is the interface type of which the variable (wagt) implemented and passed.
_pt refers to the port# to launch the api,
where the _cb as the public key, _ps as private key, respectively.
</p>

				
				
				
			
				
				<h3 id="APIMode.Stop">func (*APIMode) <a href="/src/github.com/wzlib/wzapi/apimode.go?s=12126:12149#L520">Stop</a>
					<a class="permalink" href="#APIMode.Stop">&#xb6;</a>
					
					
				</h3>
				<pre>func (a *<a href="#APIMode">APIMode</a>) Stop()</pre>
				
				
				
				
			
		
			
			
			<h2 id="AgentHTTPIntr">type <a href="/src/github.com/wzlib/wzapi/apimode.go?s=1135:2822#L55">AgentHTTPIntr</a>
				<a class="permalink" href="#AgentHTTPIntr">&#xb6;</a>
				
				
			</h2>
			<p>
Agent HTTP Interface. Each of func below will be invoked during the API mode process.
</p>

			<pre>type AgentHTTPIntr interface {

    <span class="comment">//SessionBegin invoked first when received a user authentication callback. In the event of OIDC integration, the userDetail refers to the user information in the targeted framework provided by the integration endpoint. Like SessionEnd, the interface SessionBegin will suspend the remaining process if the return error is not nil</span>
    SessionBegin(r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, userDetail *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>) <a href="/pkg/builtin/#error">error</a>

    <span class="comment">//SessionEnd similar to GC invoked by the endpoint /&lt;rev&gt;/&lt;app&gt;/logout for the purpose of managing app resource. The Logout process will stop if the return error is not nil</span>
    SessionEnd(r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, tknStatus *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#TokenStatus">TokenStatus</a>) <a href="/pkg/builtin/#error">error</a>

    <span class="comment">// Ext extend the Agent API in the following format-</span>
    <span class="comment">//&lt;agent_url&gt;/&lt;rev. e,g v1.1|v1.1beta&gt;/&lt;app name from -app flag&gt;/api/custom/path/name</span>
    <span class="comment">//this api extension should assume that the user has been authenticated and promoted by the security chain.</span>
    Ext(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, tknStatus *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#TokenStatus">TokenStatus</a>, db *<a href="/pkg/github.com/wzlib/wzutil/">util</a>.<a href="/pkg/github.com/wzlib/wzutil/#DB">DB</a>)
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="OAuth2Mode">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=6932:7204#L279">OAuth2Mode</a>
				<a class="permalink" href="#OAuth2Mode">&#xb6;</a>
				
				
			</h2>
			<p>
OAuth2Mode: launch the runtime as a OAuth2 IdP
</p>

			<pre>type OAuth2Mode struct {
<span id="OAuth2Mode.Cert"></span>    Cert *<a href="/pkg/github.com/wzlib/wzutil/">util</a>.<a href="/pkg/github.com/wzlib/wzutil/#Cert">Cert</a>

<span id="OAuth2Mode.OAuth2ModeIntr"></span>    OAuth2ModeIntr <a href="#OAuth2ModeIntr">OAuth2ModeIntr</a>

<span id="OAuth2Mode.FailURL"></span>    FailURL <a href="/pkg/builtin/#string">string</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			
				
				<h3 id="NewOAuth2Mode">func <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=8272:8358#L340">NewOAuth2Mode</a>
					<a class="permalink" href="#NewOAuth2Mode">&#xb6;</a>
					
					
				</h3>
				<pre>func NewOAuth2Mode(oagt <a href="#OAuth2ModeIntr">OAuth2ModeIntr</a>, authgrp []interface{}, _rv <a href="/pkg/builtin/#string">string</a>) *<a href="#OAuth2Mode">OAuth2Mode</a></pre>
				<p>
NewOAuth2Mode: will return an new OAuth2Mode instance
@@oagt: OAuth2 Callback Interface
@@_pt: port#
@@_pb: publickey
@@_ps: privatekey
func NewOAuth2Mode(oagt OAuth2ModeIntr, authgrp []interface{}, _oa2, _rv string) *OAuth2Mode {
</p>

				
				
			

			
				
				<h3 id="OAuth2Mode.EvalToken">func (*OAuth2Mode) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=14684:14758#L607">EvalToken</a>
					<a class="permalink" href="#OAuth2Mode.EvalToken">&#xb6;</a>
					
					
				</h3>
				<pre>func (o *<a href="#OAuth2Mode">OAuth2Mode</a>) EvalToken(tk <a href="/pkg/builtin/#string">string</a>) (cd *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>, err <a href="/pkg/builtin/#error">error</a>)</pre>
				<p>
EvalToken validate the token&#39;s expiration and its&#39; hash, and return the token owner&#39;s information
</p>

				
				
				
			
				
				<h3 id="OAuth2Mode.GetSubscriptionById">func (*OAuth2Mode) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=7206:7283#L296">GetSubscriptionById</a>
					<a class="permalink" href="#OAuth2Mode.GetSubscriptionById">&#xb6;</a>
					
					
				</h3>
				<pre>func (o *<a href="#OAuth2Mode">OAuth2Mode</a>) GetSubscriptionById(sid <a href="/pkg/builtin/#string">string</a>) (*<a href="#OAuthSubscription">OAuthSubscription</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				
				
				
				
			
				
				<h3 id="OAuth2Mode.Start">func (*OAuth2Mode) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=15219:15267#L637">Start</a>
					<a class="permalink" href="#OAuth2Mode.Start">&#xb6;</a>
					
					
				</h3>
				<pre>func (o *<a href="#OAuth2Mode">OAuth2Mode</a>) Start(_ap <a href="/pkg/builtin/#string">string</a>, tls <a href="/pkg/builtin/#bool">bool</a>)</pre>
				<p>
Starting Agent in OAuth2 mode.
</p>

				
				
				
			
				
				<h3 id="OAuth2Mode.Stop">func (*OAuth2Mode) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=28448:28474#L1199">Stop</a>
					<a class="permalink" href="#OAuth2Mode.Stop">&#xb6;</a>
					
					
				</h3>
				<pre>func (o *<a href="#OAuth2Mode">OAuth2Mode</a>) Stop()</pre>
				
				
				
				
			
		
			
			
			<h2 id="OAuth2ModeIntr">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=6433:6880#L268">OAuth2ModeIntr</a>
				<a class="permalink" href="#OAuth2ModeIntr">&#xb6;</a>
				
				
			</h2>
			<p>
Agent HTTP Interface. Each of func below will be invoked during the OAuth2 mode process.
</p>

			<pre>type OAuth2ModeIntr interface {
    GetUser(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, cd *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>)
    CheckToken(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, ts *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#TokenStatus">TokenStatus</a>)
    CreateToken(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, tkn *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#Token">Token</a>)
    CreateAuthCode(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, auth_code, callbackURL <a href="/pkg/builtin/#string">string</a>)
    Authorization(w <a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#ResponseWriter">ResponseWriter</a>, r *<a href="/pkg/net/http/">http</a>.<a href="/pkg/net/http/#Request">Request</a>, cid, uid <a href="/pkg/builtin/#string">string</a>, callbackURL <a href="/pkg/builtin/#string">string</a>, scope []<a href="/pkg/builtin/#string">string</a>)
}</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="OAuth2Ops">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=5901:6024#L248">OAuth2Ops</a>
				<a class="permalink" href="#OAuth2Ops">&#xb6;</a>
				
				
			</h2>
			<p>
OAuth2Ops host the clientid/userid, and the timestamp when the OAuth call was last invoked.
</p>

			<pre>type OAuth2Ops struct {
<span id="OAuth2Ops.ClientId"></span>    ClientId, UserId, Mode,
    Token, Code, Validate <a href="/pkg/builtin/#string">string</a>
<span id="OAuth2Ops.OriginalURL"></span>    OriginalURL *<a href="/pkg/net/url/">url</a>.<a href="/pkg/net/url/#URL">URL</a>
<span id="OAuth2Ops.TimeStamp"></span>    TimeStamp   <a href="/pkg/time/">time</a>.<a href="/pkg/time/#Time">Time</a>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="OAuthCertLocker">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=6105:6182#L256">OAuthCertLocker</a>
				<a class="permalink" href="#OAuthCertLocker">&#xb6;</a>
				
				
			</h2>
			<p>
OAuthCertLocker saves all subscriptions detail with devId as the key-value.
</p>

			<pre>type OAuthCertLocker struct {
    <a href="/pkg/sync/">sync</a>.<a href="/pkg/sync/#RWMutex">RWMutex</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="OAuthCodeLocker">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=6271:6340#L262">OAuthCodeLocker</a>
				<a class="permalink" href="#OAuthCodeLocker">&#xb6;</a>
				
				
			</h2>
			<p>
OAuthCodeLocker the structure contains a OAuth instance map referenced by auth code
</p>

			<pre>type OAuthCodeLocker struct {
    <a href="/pkg/sync/">sync</a>.<a href="/pkg/sync/#RWMutex">RWMutex</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			

			
		
			
			
			<h2 id="OAuthOIDCDetail">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=1035:1590#L46">OAuthOIDCDetail</a>
				<a class="permalink" href="#OAuthOIDCDetail">&#xb6;</a>
				
				
			</h2>
			<p>
OAuthOIDCDetail hold current OIDC setting, and all authenticated users&#39; information by OIDC user identifier
</p>

			<pre>type OAuthOIDCDetail struct {
<span id="OAuthOIDCDetail.Domain"></span>    Domain, AuthPath, TokenPath, UserURL, FailURL,
    ClientId, ClientSecret, HttpMethod,
    ScopeType <a href="/pkg/builtin/#string">string</a>

    <span class="comment">//_authOIDCUserGroup *OAuthOIDCUserLocker</span>
    <a href="/pkg/sync/">sync</a>.<a href="/pkg/sync/#RWMutex">RWMutex</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			

			
				
				<h3 id="OAuthOIDCDetail.ConvertUserScopes">func (*OAuthOIDCDetail) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=1713:1785#L67">ConvertUserScopes</a>
					<a class="permalink" href="#OAuthOIDCDetail.ConvertUserScopes">&#xb6;</a>
					
					
				</h3>
				<pre>func (oa *<a href="#OAuthOIDCDetail">OAuthOIDCDetail</a>) ConvertUserScopes(oidcscp []<a href="/pkg/builtin/#string">string</a>) []<a href="/pkg/builtin/#string">string</a></pre>
				<p>
ConvertUserScopes convert the oidc scope to the in-memory local scopes by passing list of oidcscp scopes (@@oidcscp).
</p>

				
				
				
			
				
				<h3 id="OAuthOIDCDetail.FetchOIDCTokenByAuthCode">func (*OAuthOIDCDetail) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=2884:2975#L125">FetchOIDCTokenByAuthCode</a>
					<a class="permalink" href="#OAuthOIDCDetail.FetchOIDCTokenByAuthCode">&#xb6;</a>
					
					
				</h3>
				<pre>func (oa *<a href="#OAuthOIDCDetail">OAuthOIDCDetail</a>) FetchOIDCTokenByAuthCode(code, rurl <a href="/pkg/builtin/#string">string</a>) (*<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#Token">Token</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				
				
				
				
			
				
				<h3 id="OAuthOIDCDetail.FetchOIDCUserInfo">func (*OAuthOIDCDetail) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=2323:2405#L99">FetchOIDCUserInfo</a>
					<a class="permalink" href="#OAuthOIDCDetail.FetchOIDCUserInfo">&#xb6;</a>
					
					
				</h3>
				<pre>func (oa *<a href="#OAuthOIDCDetail">OAuthOIDCDetail</a>) FetchOIDCUserInfo(tkn <a href="/pkg/builtin/#string">string</a>) (*<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>, <a href="/pkg/builtin/#error">error</a>)</pre>
				<p>
FetchOIDCUserInfo with local user id @@uid, and the oidc token @@tkn
</p>

				
				
				
			
				
				<h3 id="OAuthOIDCDetail.GetAllOIDCScopes">func (*OAuthOIDCDetail) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=2067:2127#L86">GetAllOIDCScopes</a>
					<a class="permalink" href="#OAuthOIDCDetail.GetAllOIDCScopes">&#xb6;</a>
					
					
				</h3>
				<pre>func (oa *<a href="#OAuthOIDCDetail">OAuthOIDCDetail</a>) GetAllOIDCScopes() (scp []<a href="/pkg/builtin/#string">string</a>)</pre>
				<p>
GetAllOIDCScopes return all oidc scopes in the OIDC setting
</p>

				
				
				
			
				
				<h3 id="OAuthOIDCDetail.SetOIDCUserDetail">func (*OAuthOIDCDetail) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=3437:3529#L145">SetOIDCUserDetail</a>
					<a class="permalink" href="#OAuthOIDCDetail.SetOIDCUserDetail">&#xb6;</a>
					
					
				</h3>
				<pre>func (oa *<a href="#OAuthOIDCDetail">OAuthOIDCDetail</a>) SetOIDCUserDetail(u map[<a href="/pkg/builtin/#string">string</a>]interface{}) (ud *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>)</pre>
				<p>
Setoidcuserdetail convert the user information resulting from the oidc userinfo call and return it as the UserDetail model
</p>

				
				
				
			
		
			
			
			<h2 id="OAuthSubscription">type <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=5084:5195#L215">OAuthSubscription</a>
				<a class="permalink" href="#OAuthSubscription">&#xb6;</a>
				
				
			</h2>
			
			<pre>type OAuthSubscription struct {
<span id="OAuthSubscription.Cert"></span>    Cert     *<a href="/pkg/github.com/wzlib/wzutil/">util</a>.<a href="/pkg/github.com/wzlib/wzutil/#Cert">Cert</a>
<span id="OAuthSubscription.OIDC"></span>    OIDC     *<a href="#OAuthOIDCDetail">OAuthOIDCDetail</a>
<span id="OAuthSubscription.Scope"></span>    Scope    []<a href="/pkg/builtin/#string">string</a>
<span id="OAuthSubscription.Validate"></span>    Validate <a href="/pkg/builtin/#string">string</a>
}
</pre>

			

			

			
			
			

			

			
				
				<h3 id="OAuthSubscription.GetUserDetail">func (*OAuthSubscription) <a href="/src/github.com/wzlib/wzapi/oa2mode.go?s=5247:5312#L223">GetUserDetail</a>
					<a class="permalink" href="#OAuthSubscription.GetUserDetail">&#xb6;</a>
					
					
				</h3>
				<pre>func (c *<a href="#OAuthSubscription">OAuthSubscription</a>) GetUserDetail() (ud *<a href="/pkg/github.com/wzlib/wzschema/">model</a>.<a href="/pkg/github.com/wzlib/wzschema/#UserDetail">UserDetail</a>)</pre>
				<p>
GetUserDetail get the local subscription detail
</p>

				
				
				
			
		
			
			
			<h2 id="ProfileLocker">type <a href="/src/github.com/wzlib/wzapi/apimode.go?s=610:685#L30">ProfileLocker</a>
				<a class="permalink" href="#ProfileLocker">&#xb6;</a>
				
				
			</h2>
			
			<pre>type ProfileLocker struct {
    <a href="/pkg/sync/">sync</a>.<a href="/pkg/sync/#RWMutex">RWMutex</a>
    <span class="comment">// contains filtered or unexported fields</span>
}
</pre>

			

			

			
			
			

			

			
		
	

	







<div id="footer">
Build version go1.12.17.<br>
Except as <a href="https://developers.google.com/site-policies#restrictions">noted</a>,
the content of this page is licensed under the
Creative Commons Attribution 3.0 License,
and code is licensed under a <a href="/LICENSE">BSD license</a>.<br>
<a href="/doc/tos.html">Terms of Service</a> |
<a href="http://www.google.com/intl/en/policies/privacy/">Privacy Policy</a>
</div>

</div><!-- .container -->
</div><!-- #page -->

</body>
</html>

